var Acl;(function(){define(["jQuery","lpp.mvc.controls/utilities"],function(n){return function(t,i,r,u,f){n(function(){function o(){return n(".Grid.Subjects > tbody > tr",e)}function a(){var i=n.map(t,function(t,i){return n.map(t.own,function(n,t){return n===null||n===undefined?undefined:i+":"+t+":"+(n?"allow":"deny")})}).join();n("input.ValueField",e).val(i).trigger("change")}function h(t){if(t===undefined)return v;v=t,t?(s.show(),n.each(f,function(){var n=this;n.setPrivileges(t.own,t.inherited)})):s.hide()}function c(n){return n.find("a.Remove").data("id")}var v;i="#"+i;var e=n(i),l=n(".Grid.Subjects",e),s=n(".PrivilegesBox",e);n.each(f,function(){var i=this,t=this;t.onChange(function(){var i=h();i&&(n.extend(i.own,t.getPrivileges()),n.each(f,function(){var n=this;t!=n&&n.setPrivileges(i.own,i.inherited)}),a())})}),e.delegate(".Subject","click",function(){var i=n(this).closest("tr"),r=c(i);r&&(h(t[r]),o().removeClass("Selected"),i.addClass("Selected"))}),n(".Subjects .Add",e).click(function(){return r.selectSubject(function(i){var u=o(),r;u.filter(function(){return!c(n(this))}).remove(),n.each(i,function(){var i=u.filter("[data-id="+this.Id+"]");if(i.length){r=i.first();return}t[this.Id]={own:{},inherited:{}},l.children("tbody").append(r=n("<tr>").append('<td><a class="Remove" href="#" data-id="'+this.Id+'">[remove]<\/a><\/td>').append(n('<td class="Subject">').html(this.Name).attr("sort-value",this.Name)))}),o().alternateClasses("","Alt"),r&&r.find(".Subject").click()}),!1}),e.delegate(".Subjects .Remove","click",function(){var f=n(this).closest("tr"),s=c(f),i,r;return f.remove(),delete t[s],a(),i=o(),i.length==0?l.children("tbody").append(n("<tr><td colspan=2>").html(u||"No access control records found")):i.alternateClasses("","Alt"),r=n("tbody > tr > td.Subject",e).first(),r.length?r.click():h(null),!1}),s.hide(),n("tbody > tr > td.Subject",e).first().click()})}})})(Acl||(Acl={}))