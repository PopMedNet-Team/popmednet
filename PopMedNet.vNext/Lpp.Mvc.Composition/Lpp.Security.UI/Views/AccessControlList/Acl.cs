//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.34014
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

namespace Lpp.Security.UI.Views.AccessControlList {
    using System;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Net;
    using System.Web;
    using System.Web.Helpers;
    using System.Web.Security;
    using System.Web.UI;
    using System.Web.WebPages;
    using System.Web.Mvc;
    using System.Web.Mvc.Ajax;
    using System.Web.Mvc.Html;
    using System.Web.Routing;
    
    #line 3 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
    using Lpp;
    
    #line default
    #line hidden
    using Lpp.Mvc;
    using Lpp.Mvc.Controls;
    using Lpp.Security.UI;
    using Lpp.Security.UI.Models;
    
    #line 2 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
    using Lpp.Security;
    
    #line default
    #line hidden
    
    #line 4 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
    using Lpp.Utilities.Legacy;
    
    #line default
    #line hidden
    
    
    public partial class Acl : System.Web.Mvc.WebViewPage<AccessControlListModel> {
        
#line hidden

        
        public Acl() {
        }
        
        protected System.Web.HttpApplication ApplicationInstance {
            get {
                return ((System.Web.HttpApplication)(Context.ApplicationInstance));
            }
        }
        
        public override void Execute() {




WriteLiteral("\r\n");


            
            #line 6 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
   this.Stylesheet( "security.min.css" );
   var subjectSelectorHandle = Html.UniqueId();
   var noRecordsMessage = "No access control records found";
   var pEditors = Model.PrivilegeEditors.Select( e => new { e, handle = Html.UniqueId() } ).ToList();
   var id = Html.UniqueId();


            
            #line default
            #line hidden

            
            #line 12 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
Write(Model.Parameters.SubjectSelector.Render( Html, subjectSelectorHandle ));

            
            #line default
            #line hidden
WriteLiteral("\r\n\r\n<div class=\"Acl\" id=\"");


            
            #line 14 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
                Write(id);

            
            #line default
            #line hidden
WriteLiteral("\">\r\n    <input type=\"hidden\" name=\"");


            
            #line 15 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
                          Write(Model.Parameters.FieldName);

            
            #line default
            #line hidden
WriteLiteral("\" class=\"ValueField\"\r\n           value=\"");


            
            #line 16 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
             Write(string.Join( ",", from s in Model.InitialEntries
                                     from e in s.OwnEntries
                                     select string.Format( "{0}:{1}:{2}", s.Subject.SID, e.First.SerializedId, e.Second ) ));

            
            #line default
            #line hidden
WriteLiteral("\" />\r\n    ");


            
            #line 19 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
Write(Html.Render<IGrid>()
        .From( Model.InitialEntries.Select( e => e.Subject ).OrderBy( s => s.DisplayName ) )
        .Attributes( new { @class = "Grid Subjects" } )
        .Column(item => new System.Web.WebPages.HelperResult(__razor_template_writer => {

            
            #line default
            #line hidden

WriteLiteralTo(@__razor_template_writer, " ");

WriteLiteralTo(@__razor_template_writer, "<a class=\"Remove\" data-id=\"");


            
            #line 22 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
            WriteTo(@__razor_template_writer, item.SID);

            
            #line default
            #line hidden
WriteLiteralTo(@__razor_template_writer, "\" href=\"#\">[remove]</a>");


            
            #line 22 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
                                                                           }), c => { } )
        .ClientSideSortColumn( s => s.DisplayName, setOptions: c => c.Title( "Subject" ).Class( "Subject" ) )
        .With( o => o.NoDataMessage =item => new System.Web.WebPages.HelperResult(__razor_template_writer => {

            
            #line default
            #line hidden

WriteLiteralTo(@__razor_template_writer, " ");


            
            #line 24 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
            WriteTo(@__razor_template_writer, noRecordsMessage);

            
            #line default
            #line hidden
WriteLiteralTo(@__razor_template_writer, " ");


            
            #line 24 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
                                                                    }))
        .FooterPrefix(item => new System.Web.WebPages.HelperResult(__razor_template_writer => {

            
            #line default
            #line hidden

WriteLiteralTo(@__razor_template_writer, " ");

WriteLiteralTo(@__razor_template_writer, "<div class=\"ActionButtons\">\r\n                            <button class=\"ui-standa" +
"rd-button Add\">Add...</button>\r\n                        </div>\r\n");


            
            #line 28 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
})        )
    );

            
            #line default
            #line hidden
WriteLiteral("\r\n\r\n    <div class=\"PrivilegesBox\">\r\n");


            
            #line 32 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
         foreach ( var e in pEditors )
        {

            
            #line default
            #line hidden
WriteLiteral("            ");


            
            #line 34 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
             Write(e.e.Render( Html, e.handle ));

            
            #line default
            #line hidden
WriteLiteral("\r\n");


            
            #line 35 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
        }

            
            #line default
            #line hidden
WriteLiteral("    </div>\r\n\r\n</div>\r\n<script type=\"text/javascript\">\r\n    require([\'jQuery\',\'");


            
            #line 40 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
                  Write(Html.Raw( this.Resource( "acl.min.js" ) ));

            
            #line default
            #line hidden
WriteLiteral("\',\'");


            
            #line 40 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
                                                               Write(subjectSelectorHandle);

            
            #line default
            #line hidden
WriteLiteral("\',\r\n        ");


            
            #line 41 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
   Write(Html.Raw( string.Join( ",", pEditors.Select( e => "'" + e.handle + "'" ) ) ));

            
            #line default
            #line hidden
WriteLiteral("], \r\n        function ($, bind, subjSelector) {\r\n\r\n            var acl = ");


            
            #line 44 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
                 Write(Html.Raw( Json.Encode(
                Model.InitialEntries.DistinctBy(pl => pl.Subject.SID).ToDictionary(
                    pl => pl.Subject.SID.ToString(),
                    pl => new
                    {
                        own = pl.OwnEntries.DistinctBy(e => e.First.SerializedId).ToDictionary( e => e.First.SerializedId, e => e.Second == AclEntryKind.Allow ),
                        inherited = pl.InheritedEntries.DistinctBy(e => e.First.SerializedId).ToDictionary( e => e.First.SerializedId, e => new
                            {
                                allow = e.Second.Kind == AclEntryKind.Allow,
                                inheritedFrom = string.Join( " x ", e.Second.InheritedFrom.Elements )
                            } )
                    }
                )
            ) ));

            
            #line default
            #line hidden
WriteLiteral(";\r\n\r\n            bind(acl, \"");


            
            #line 59 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
                  Write(id);

            
            #line default
            #line hidden
WriteLiteral("\", subjSelector, \"");


            
            #line 59 "D:\Lincoln Peak\PMN\Dns\Lpp.Mvc.Composition\Lpp.Security.UI\Views\AccessControlList\Acl.cshtml"
                                       Write(noRecordsMessage);

            
            #line default
            #line hidden
WriteLiteral("\", $.makeArray(arguments).slice(3)); \r\n        }\r\n    );\r\n</script>");


        }
    }
}
