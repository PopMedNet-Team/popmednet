var Plugins;
(function (Plugins) {
    var Requests;
    (function (Requests) {
        var QueryBuilder;
        (function (QueryBuilder) {
            var MDQ;
            (function (MDQ) {
                var Terms = (function () {
                    function Terms() {
                    }
                    Object.defineProperty(Terms, "DataCheckerQueryTypeID", {
                        get: function () {
                            return '1F065B02-5BF3-4340-A412-84465C9B164C';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "AgeRangeID", {
                        get: function () {
                            return 'D9DD6E82-BBCA-466A-8022-B54FF3D99A3C';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "DrugClassID", {
                        get: function () {
                            return '75290001-0E78-490C-9635-A3CA01550704';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "DrugNameID", {
                        get: function () {
                            return '0E1F0001-CA0C-42D2-A9CC-A3CA01550E84';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "HCPCSProcedureCodesID", {
                        get: function () {
                            return '096A0001-73B4-405D-B45F-A3CA014C6E7D';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "ICD9Diagnosis3digitID", {
                        get: function () {
                            return '5E5020DC-C0E4-487F-ADF2-45431C2B7695';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "ICD9Diagnosis4digitID", {
                        get: function () {
                            return 'D0800001-2810-48ED-96B9-A3D40146BAAE';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "ICD9Diagnosis5digitID", {
                        get: function () {
                            return '80750001-6C3B-4C2D-90EC-A3D40146C26D';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "ICD9Procedure3digitID", {
                        get: function () {
                            return 'E1CC0001-1D9A-442A-94C4-A3CA014C7B94';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "ICD9Procedure4digitID", {
                        get: function () {
                            return '9E870001-1D48-4AA3-8889-A3D40146CCB3';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "ZipCodeID", {
                        get: function () {
                            return '8B5FAA77-4A4B-4AC7-B817-69F1297E24C5';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "CombinedDiagnosisCodesID", {
                        get: function () {
                            return '86110001-4BAB-4183-B0EA-A4BC0125A6A7';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "ESPCombinedDiagnosisCodesID", {
                        get: function () {
                            return 'A21E9775-39A4-4ECC-848B-1DC881E13689';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "MetadataRefreshID", {
                        get: function () {
                            return '421BAC16-CAAC-4918-8760-A10FF76CC87B';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "ConditionID", {
                        get: function () {
                            return 'EC593176-D0BF-4E5A-BCFF-4BBD13E88DBF';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "TrialID", {
                        get: function () {
                            return '56A38F6D-993A-4953-BCB9-11BDD809C0B4';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "PatientReportedOutcomeID", {
                        get: function () {
                            return 'AE87C785-BB74-4708-B0CD-FA91D584615C';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "PatientReportedOutcomeEncounterID", {
                        get: function () {
                            return 'A11DCC97-4C8D-4B80-AE61-58ECB2F66C3D';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "VisitsID", {
                        get: function () {
                            return 'F01BE0A4-7D8E-4288-AE33-C65166AF8335';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "SexID", {
                        get: function () {
                            return '71B4545C-345B-48B2-AF5E-F84DC18E4E1A';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "CodeMetricID", {
                        get: function () {
                            return 'E39D0001-07A1-4DFD-9299-A3CB00F2474B';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "CoverageID", {
                        get: function () {
                            return 'DC880001-23B2-4F36-94E2-A3CB00DA8248';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "CriteriaID", {
                        get: function () {
                            return '17540001-8185-41BB-BE64-A3CB00F27EC2';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "DispensingMetricID", {
                        get: function () {
                            return '16ED0001-7E2D-4B27-B943-A3CB0162C262';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "EthnicityID", {
                        get: function () {
                            return '702CE918-9A59-4082-A8C7-A9234536FE79';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "FacilityID", {
                        get: function () {
                            return 'A257DA68-9557-4D6A-AEBD-541AA9BDD145';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "HeightID", {
                        get: function () {
                            return '8BC627CA-5729-4E7A-9702-0000A45A0018';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "HispanicID", {
                        get: function () {
                            return 'D26FE166-49A2-47F8-87E2-4F42A945D4D5';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "ObservationPeriodID", {
                        get: function () {
                            return '98A78326-35D2-461A-B858-5B69E0FED28A';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "QuarterYearID", {
                        get: function () {
                            return 'D62F0001-3FE1-4910-99A9-A3CB014C2BC7';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "RaceID", {
                        get: function () {
                            return '834F0001-FA03-4ECD-BE28-A3CD00EC02E2';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "SettingID", {
                        get: function () {
                            return '2DE50001-7882-4EDE-AC4F-A3CB00D9051A';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "TobaccoUseID", {
                        get: function () {
                            return '342C354B-9ECC-479B-BE61-1770E4B44675';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "WeightID", {
                        get: function () {
                            return '3B0ED310-DDE9-4836-9857-0000A45A0018';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "YearID", {
                        get: function () {
                            return '781A0001-1FF0-41AB-9E67-A3CB014C37F2';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "VitalsMeasureDateID", {
                        get: function () {
                            return 'F9920001-AEB1-425C-A929-A4BB01515850';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "ProcedureCodesID", {
                        get: function () {
                            return 'F81AE5DE-7B35-4D7A-B398-A72200CE7419';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "LOINCCodesID", {
                        get: function () {
                            return 'F5903376-D2A5-486F-92D3-1F97D598A221';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "PrescribingCodesID", {
                        get: function () {
                            return '793BD948-C90C-45DA-B4B7-F8E2387E1A78';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "FileUploadID", {
                        get: function () {
                            return '2F60504D-9B2F-4DB1-A961-6390117D3CAC';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "ModularProgramID", {
                        get: function () {
                            return 'A1AE0001-E5B4-46D2-9FAD-A3D8014FFFD8';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(Terms, "ClinicalObservationsID", {
                        get: function () {
                            return '7A51AB7A-AEC5-4A4B-A073-FBFF754EA478';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Terms.Compare = function (a, b) {
                        if ((a == null && b != null) || (a != null && b == null))
                            return false;
                        if (a == null && b == null)
                            return true;
                        return a.toLowerCase() === b.toLowerCase();
                    };
                    Terms.GroupedTerms = [
                        Terms.ConditionID,
                        Terms.HCPCSProcedureCodesID,
                        Terms.CombinedDiagnosisCodesID,
                        Terms.ICD9Diagnosis3digitID,
                        Terms.ICD9Diagnosis4digitID,
                        Terms.ICD9Diagnosis5digitID,
                        Terms.ICD9Procedure3digitID,
                        Terms.ICD9Procedure4digitID,
                        Terms.ESPCombinedDiagnosisCodesID,
                        Terms.DrugClassID,
                        Terms.DrugNameID,
                        Terms.VisitsID,
                        Terms.AgeRangeID,
                        Terms.SexID,
                        Terms.CodeMetricID,
                        Terms.CoverageID,
                        Terms.CriteriaID,
                        Terms.DispensingMetricID,
                        Terms.EthnicityID,
                        Terms.FacilityID,
                        Terms.HeightID,
                        Terms.HispanicID,
                        Terms.ObservationPeriodID,
                        Terms.QuarterYearID,
                        Terms.RaceID,
                        Terms.SettingID,
                        Terms.TobaccoUseID,
                        Terms.WeightID,
                        Terms.YearID,
                        Terms.ZipCodeID,
                        Terms.VitalsMeasureDateID,
                        Terms.ProcedureCodesID,
                        Terms.TrialID,
                        Terms.PatientReportedOutcomeID,
                        Terms.LOINCCodesID,
                        Terms.PrescribingCodesID,
                        Terms.ClinicalObservationsID
                    ];
                    Terms.NonCodeGroupedTerms = [
                        Terms.VisitsID,
                        Terms.AgeRangeID,
                        Terms.SexID,
                        Terms.CodeMetricID,
                        Terms.CoverageID,
                        Terms.CriteriaID,
                        Terms.DispensingMetricID,
                        Terms.EthnicityID,
                        Terms.FacilityID,
                        Terms.HeightID,
                        Terms.HispanicID,
                        Terms.ObservationPeriodID,
                        Terms.QuarterYearID,
                        Terms.RaceID,
                        Terms.SettingID,
                        Terms.TobaccoUseID,
                        Terms.WeightID,
                        Terms.YearID,
                        Terms.ZipCodeID,
                        Terms.VitalsMeasureDateID,
                        Terms.TrialID,
                        Terms.PatientReportedOutcomeID
                    ];
                    Terms.DataCheckerProcedureCodeTypes = [
                        { text: 'Any', value: '' },
                        { text: 'ICD-9-CM', value: '09' },
                        { text: 'ICD-10-CM', value: '10' },
                        { text: 'ICD-11-CM', value: '11' },
                        { text: 'CPT Category II', value: 'C2' },
                        { text: 'CPT Category III', value: 'C3' },
                        { text: 'CPT-4 (i.e., HCPCS Level I)', value: 'C4' },
                        { text: 'HCPCS (i.e., HCPCS Level II)', value: 'HC' },
                        { text: 'HCPCS Level III', value: 'H3' },
                        { text: 'LOINC', value: 'LC' },
                        { text: 'Local Homegrown', value: 'LO' },
                        { text: 'NDC', value: 'ND' },
                        { text: 'Revenue', value: 'RE' },
                        { text: 'Other', value: 'OT' }
                    ];
                    Terms.DataCheckerDiagnosisCodeTypes = [
                        { text: 'Any', value: '' },
                        { text: 'ICD-9-CM', value: '09' },
                        { text: 'ICD-10-CM', value: '10' },
                        { text: 'ICD-11-CM', value: '11' },
                        { text: 'SNOMED CT', value: 'SM' },
                        { text: 'Other', value: 'OT' }
                    ];
                    return Terms;
                }());
                MDQ.Terms = Terms;
                var TermValueFilter = (function () {
                    function TermValueFilter(models) {
                        var _this = this;
                        this._models = ko.observableArray(models || []);
                        this._containsPCORnet = ko.pureComputed(function () { return TermValueFilter.ContainsModel(_this._models(), TermValueFilter.PCORnetModelID); });
                        this._containsSummaryTables = ko.pureComputed(function () { return TermValueFilter.ContainsModel(_this._models(), TermValueFilter.SummaryTablesModelID); });
                        this._containsESP = ko.pureComputed(function () { return TermValueFilter.ContainsModel(_this._models(), TermValueFilter.ESPModelID); });
                        this._containsDataChecker = ko.pureComputed(function () { return TermValueFilter.ContainsModel(_this._models(), TermValueFilter.DataCheckerModelID); });
                        this._containsModularProgram = ko.pureComputed(function () { return TermValueFilter.ContainsModel(_this._models(), TermValueFilter.ModularProgramModelID); });
                        this.SexValues = ko.pureComputed(this.getSexValues.bind(this));
                        this.SettingsValues = ko.pureComputed(this.getSettingsValues.bind(this));
                        this.RaceValues = ko.pureComputed(this.getRaceValues.bind(this));
                        this.RaceEthnicityValues = ko.pureComputed(this.getRaceEthnicityValues.bind(this));
                        this.AgeRangeStratifications = ko.pureComputed(this.getAgeRangeStratifications.bind(this));
                    }
                    Object.defineProperty(TermValueFilter, "PCORnetModelID", {
                        get: function () {
                            return '85ee982e-f017-4bc4-9acd-ee6ee55d2446';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(TermValueFilter, "SummaryTablesModelID", {
                        get: function () {
                            return 'cc14e6a2-99a8-4ef8-b4cb-779a7b93a7bb';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(TermValueFilter, "ESPModelID", {
                        get: function () {
                            return '7c69584a-5602-4fc0-9f3f-a27f329b1113';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(TermValueFilter, "DataCheckerModelID", {
                        get: function () {
                            return '321adaa1-a350-4dd0-93de-5de658a507df';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(TermValueFilter, "ModularProgramModelID", {
                        get: function () {
                            return '1b0ffd4c-3eef-479d-a5c4-69d8ba0d0154';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(TermValueFilter, "DistributedRegressionModelID", {
                        get: function () {
                            return '4c8a25dc-6816-4202-88f4-6d17e72a43bc';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    Object.defineProperty(TermValueFilter, "FileDistributionModelID", {
                        get: function () {
                            return '00bf515f-6539-405b-a617-ca9f8aa12970';
                        },
                        enumerable: false,
                        configurable: true
                    });
                    TermValueFilter.ContainsModel = function (models, id) {
                        for (var i = 0; i < models.length; i++) {
                            if (Constants.Guid.compare(models[i], id) == 0)
                                return true;
                        }
                        return false;
                    };
                    TermValueFilter.QueryContainsTerm = function (query, termID) {
                        if (query == null || termID == null)
                            return false;
                        for (var i = 0; i < query.Where.Criteria.length; i++) {
                            var criteria = query.Where.Criteria[i];
                            if (this.CriteriaContainsTerm(criteria, termID)) {
                                return true;
                            }
                        }
                        return false;
                    };
                    TermValueFilter.CriteriaContainsTerm = function (criteria, termID) {
                        if (criteria == null || termID == null) {
                            return false;
                        }
                        for (var i = 0; i < criteria.Terms.length; i++) {
                            var term = criteria.Terms[i];
                            if (Terms.Compare(term.Type, termID))
                                return true;
                        }
                        if (criteria.Criteria) {
                            for (var j = 0; j < criteria.Criteria.length; j++) {
                                if (this.CriteriaContainsTerm(criteria.Criteria[j], termID)) {
                                    return true;
                                }
                            }
                        }
                        return false;
                    };
                    TermValueFilter.GetTranslations = function (translations, values) {
                        var selected = [];
                        for (var i = 0; i < translations.length; i++) {
                            var item = translations[i];
                            if (values.indexOf(item.value) >= 0) {
                                selected.push(item);
                            }
                            if (selected.length == values.length)
                                break;
                        }
                        return selected;
                    };
                    TermValueFilter.prototype.UpdateModels = function (models) {
                        this._models(models || []);
                    };
                    TermValueFilter.prototype.HasModel = function (modelID) {
                        return TermValueFilter.ContainsModel(this._models(), modelID);
                    };
                    TermValueFilter.prototype.getSexValues = function () {
                        var sexTranslations = [];
                        Dns.Enums.SexStratificationsTranslation.forEach(function (s) {
                            if (s.value != Dns.Enums.SexStratifications.MaleAndFemaleAggregated)
                                sexTranslations.push(s);
                        });
                        if (this._models().length == 0)
                            return sexTranslations;
                        if (this._containsSummaryTables() == true)
                            return TermValueFilter.GetTranslations(Dns.Enums.SexStratificationsTranslation, [Dns.Enums.SexStratifications.FemaleOnly, Dns.Enums.SexStratifications.MaleOnly, Dns.Enums.SexStratifications.MaleAndFemale, Dns.Enums.SexStratifications.MaleAndFemaleAggregated, Dns.Enums.SexStratifications.Unknown]);
                        if (this._containsPCORnet() == false) {
                            return TermValueFilter.GetTranslations(Dns.Enums.SexStratificationsTranslation, [Dns.Enums.SexStratifications.FemaleOnly, Dns.Enums.SexStratifications.MaleOnly, Dns.Enums.SexStratifications.MaleAndFemale]);
                        }
                        return sexTranslations;
                    };
                    TermValueFilter.prototype.getSettingsValues = function () {
                        if (this._models().length == 0)
                            return Dns.Enums.SettingsTranslation;
                        var translations = [];
                        if (this._containsSummaryTables() && this._containsPCORnet()) {
                            TermValueFilter.GetTranslations(Dns.Enums.SettingsTranslation, [Dns.Enums.Settings.IP, Dns.Enums.Settings.AV, Dns.Enums.Settings.ED, Dns.Enums.Settings.AN, Dns.Enums.Settings.EI, Dns.Enums.Settings.IS, Dns.Enums.Settings.OS, Dns.Enums.Settings.IC, Dns.Enums.Settings.OA, Dns.Enums.Settings.NI, Dns.Enums.Settings.UN, Dns.Enums.Settings.OT]).forEach(function (i) { return translations.push(i); });
                        }
                        if (this._containsSummaryTables()) {
                            TermValueFilter.GetTranslations(Dns.Enums.SettingsTranslation, [Dns.Enums.Settings.IP, Dns.Enums.Settings.AV, Dns.Enums.Settings.ED, Dns.Enums.Settings.AN]).forEach(function (i) { return translations.push(i); });
                        }
                        if (this._containsPCORnet()) {
                            TermValueFilter.GetTranslations(Dns.Enums.SettingsTranslation, [Dns.Enums.Settings.IP, Dns.Enums.Settings.AV, Dns.Enums.Settings.ED, Dns.Enums.Settings.EI, Dns.Enums.Settings.IS, Dns.Enums.Settings.OS, Dns.Enums.Settings.IC, Dns.Enums.Settings.OA, Dns.Enums.Settings.NI, Dns.Enums.Settings.UN, Dns.Enums.Settings.OT]).forEach(function (i) { return translations.push(i); });
                        }
                        return translations;
                    };
                    TermValueFilter.prototype.getRaceValues = function () {
                        if (this._models().length == 0 || this._containsPCORnet())
                            return Dns.Enums.RaceTranslation;
                        if (this._containsSummaryTables()) {
                            return TermValueFilter.GetTranslations(Dns.Enums.RaceTranslation, [Dns.Enums.Race.Native, Dns.Enums.Race.Asian, Dns.Enums.Race.Black, Dns.Enums.Race.Pacific, Dns.Enums.Race.White, Dns.Enums.Race.Unknown]);
                        }
                        return [];
                    };
                    TermValueFilter.prototype.getRaceEthnicityValues = function () {
                        if (this._models().length == 0)
                            return Dns.Enums.EthnicitiesTranslation;
                        if (this._containsESP()) {
                            return TermValueFilter.GetTranslations(Dns.Enums.EthnicitiesTranslation, [Dns.Enums.Ethnicities.Unknown, Dns.Enums.Ethnicities.Native, Dns.Enums.Ethnicities.Asian, Dns.Enums.Ethnicities.Black, Dns.Enums.Ethnicities.White, Dns.Enums.Ethnicities.Hispanic]);
                        }
                        return [];
                    };
                    TermValueFilter.prototype.getAgeRangeStratifications = function () {
                        if (this._models().length == 0)
                            return Dns.Enums.AgeStratificationsTranslation;
                        var translations = [];
                        if (this._containsSummaryTables()) {
                            TermValueFilter.GetTranslations(Dns.Enums.AgeStratificationsTranslation, [Dns.Enums.AgeStratifications.Ten, Dns.Enums.AgeStratifications.Seven, Dns.Enums.AgeStratifications.Four, Dns.Enums.AgeStratifications.Two, Dns.Enums.AgeStratifications.None]).forEach(function (i) { return translations.push(i); });
                        }
                        if (this._containsESP() || this._containsPCORnet()) {
                            TermValueFilter.GetTranslations(Dns.Enums.AgeStratificationsTranslation, [Dns.Enums.AgeStratifications.FiveYearGrouping, Dns.Enums.AgeStratifications.TenYearGrouping]).forEach(function (i) { return translations.push(i); });
                        }
                        if (this._containsPCORnet()) {
                            TermValueFilter.GetTranslations(Dns.Enums.AgeStratificationsTranslation, [Dns.Enums.AgeStratifications.None]).forEach(function (i) { return translations.push(i); });
                        }
                        return translations;
                    };
                    TermValueFilter.prototype.ConfirmTemplateProperties = function (query, termTemplates) {
                        var flattenedTerms = this.FlattenTermTemplates(termTemplates, []);
                        for (var i = 0; i < query.Where.Criteria.length; i++) {
                            var criteria = query.Where.Criteria[i];
                            this.ConfirmCriteria(criteria, flattenedTerms);
                            if (criteria.Terms && criteria.Terms.length > 0) {
                                var _loop_1 = function (j) {
                                    var term = criteria.Terms[j];
                                    var termTemplate = ko.utils.arrayFirst(flattenedTerms, function (template) { return template.TermID == term.Type; });
                                    if (termTemplate) {
                                        this_1.ConfirmTermValues(term, termTemplate);
                                    }
                                };
                                var this_1 = this;
                                for (var j = 0; j < criteria.Terms.length; j++) {
                                    _loop_1(j);
                                }
                            }
                        }
                    };
                    TermValueFilter.prototype.ConfirmTemplatePropertiesForViewModel = function (query, termTemplates) {
                        var flattenedTerms = this.FlattenTermTemplates(termTemplates, []);
                        var rootCriteria = query.Where.Criteria();
                        for (var i = 0; i < rootCriteria.length; i++) {
                            var criteria = rootCriteria[i];
                            this.ConfirmCriteriaForViewModel(criteria, flattenedTerms);
                            if (criteria.Terms() && criteria.Terms().length > 0) {
                                var _loop_2 = function (j) {
                                    var term = criteria.Terms()[j];
                                    var termTemplate = ko.utils.arrayFirst(flattenedTerms, function (template) { return template.TermID == term.Type(); });
                                    if (termTemplate) {
                                        this_2.ConfirmTermValuesForViewModel(term, termTemplate);
                                    }
                                };
                                var this_2 = this;
                                for (var j = 0; j < criteria.Terms().length; j++) {
                                    _loop_2(j);
                                }
                            }
                        }
                        var temporalEvents = query.TemporalEvents();
                        for (var i = 0; i < temporalEvents.length; i++) {
                            var temporalEvent = temporalEvents[i];
                            var rootCriteria_1 = temporalEvent.Criteria();
                            for (var j = 0; j < rootCriteria_1.length; j++) {
                                var criteria = rootCriteria_1[j];
                                this.ConfirmCriteriaForViewModel(criteria, flattenedTerms);
                                if (criteria.Terms() && criteria.Terms().length > 0) {
                                    var _loop_3 = function (k) {
                                        var term = criteria.Terms()[k];
                                        var termTemplate = ko.utils.arrayFirst(flattenedTerms, function (template) { return template.TermID == term.Type(); });
                                        if (termTemplate) {
                                            this_3.ConfirmTermValuesForViewModel(term, termTemplate);
                                        }
                                    };
                                    var this_3 = this;
                                    for (var k = 0; k < criteria.Terms().length; k++) {
                                        _loop_3(k);
                                    }
                                }
                            }
                        }
                    };
                    TermValueFilter.prototype.FlattenTermTemplates = function (termTemplates, flattened) {
                        for (var i = 0; i < termTemplates.length; i++) {
                            if (termTemplates[i].TermID) {
                                flattened.push(termTemplates[i]);
                            }
                            if (termTemplates[i].Terms) {
                                flattened = this.FlattenTermTemplates(termTemplates[i].Terms, flattened);
                            }
                        }
                        return flattened;
                    };
                    TermValueFilter.prototype.ConfirmCriteria = function (criteria, termTemplates) {
                        if (criteria.Terms) {
                            var term_1;
                            var termTemplate = void 0;
                            for (var i = 0; i < criteria.Terms.length; i++) {
                                term_1 = criteria.Terms[i];
                                termTemplate = ko.utils.arrayFirst(termTemplates, function (template) { return template.TermID == term_1.Type; });
                                if (termTemplate) {
                                    this.ConfirmTermValues(term_1, termTemplate);
                                }
                            }
                        }
                        if (criteria.Criteria && criteria.Criteria.length > 0) {
                            for (var j = 0; j < criteria.Criteria.length; j++) {
                                this.ConfirmCriteria(criteria.Criteria[j], termTemplates);
                            }
                        }
                    };
                    TermValueFilter.prototype.ConfirmCriteriaForViewModel = function (criteria, termTemplates) {
                        var terms = criteria.Terms();
                        if (terms) {
                            var term_2;
                            var termTemplate = void 0;
                            for (var i = 0; i < terms.length; i++) {
                                term_2 = terms[i];
                                termTemplate = ko.utils.arrayFirst(termTemplates, function (template) { return template.TermID == term_2.Type(); });
                                if (termTemplate) {
                                    this.ConfirmTermValuesForViewModel(term_2, termTemplate);
                                }
                            }
                        }
                        var subCriteria = criteria.Criteria();
                        if (subCriteria && subCriteria.length > 0) {
                            for (var j = 0; j < subCriteria.length; j++) {
                                this.ConfirmCriteriaForViewModel(subCriteria[j], termTemplates);
                            }
                        }
                    };
                    TermValueFilter.prototype.ConfirmTermValues = function (term, termTemplate) {
                        var termProperties = Object.keys(term.Values);
                        var tvalProperties = Object.keys(termTemplate.ValueTemplate);
                        var propertyName;
                        for (var i = 0; i < tvalProperties.length; i++) {
                            propertyName = tvalProperties[i];
                            if (termProperties.indexOf(propertyName) < 0) {
                                term.Values[propertyName] = termTemplate.ValueTemplate[propertyName];
                            }
                        }
                    };
                    TermValueFilter.prototype.ConfirmTermValuesForViewModel = function (term, termTemplate) {
                        var unwrapped = ko.unwrap(term.Values);
                        var termProperties = Object.keys(unwrapped);
                        var tvalProperties = Object.keys(termTemplate.ValueTemplate);
                        var propertyName;
                        var hasChanges = false;
                        for (var i = 0; i < tvalProperties.length; i++) {
                            propertyName = tvalProperties[i];
                            if (termProperties.indexOf(propertyName) < 0) {
                                unwrapped[propertyName] = termTemplate.ValueTemplate[propertyName];
                                hasChanges = true;
                            }
                        }
                        if (hasChanges) {
                            term.Values(unwrapped);
                        }
                        var values = Global.Helpers.ConvertTermObject(term.Values());
                        term.Values(values);
                    };
                    return TermValueFilter;
                }());
                MDQ.TermValueFilter = TermValueFilter;
            })(MDQ = QueryBuilder.MDQ || (QueryBuilder.MDQ = {}));
        })(QueryBuilder = Requests.QueryBuilder || (Requests.QueryBuilder = {}));
    })(Requests = Plugins.Requests || (Plugins.Requests = {}));
})(Plugins || (Plugins = {}));
